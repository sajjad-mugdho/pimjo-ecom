"use client";

import React from "react";
import { apiGet } from "@/lib/api";
import type { StatsSummary } from "@/types";
import StatisticsCard from "./StatisticsCard";
import MonthlySalesChart from "./MonthlySalesChart";
import MonthlyTargetGauge from "./MonthlyTargetGauge";
import DemographicCard from "./DemographicCard";
import OrderTable from "./OrderTable";

const DashboardMain = () => {
  const [stats, setStats] = React.useState<StatsSummary | null>(null);
  const [loading, setLoading] = React.useState(true);
  const [error, setError] = React.useState<string | null>(null);

  React.useEffect(() => {
    let mounted = true;
    setLoading(true);
    apiGet<{ summary: StatsSummary }>("/api/stats")
      .then((res) => {
        if (!mounted) return;
        setStats(res.summary);
        setError(null);
      })
      .catch((err) => {
        if (!mounted) return;
        setError(err.message || "Failed to load stats");
      })
      .finally(() => mounted && setLoading(false));

    return () => {
      mounted = false;
    };
  }, []);

  return (
    <section className="flex items-center justify-center gap-6 flex-wrap">
      {/* left section */}
      <div className="">
        {/* upper 2 sections */}
        <div className="flex items-center justify-center gap-6 mb-6">
          <div className="min-w-[300px] h-[180px] p-6 bg-white rounded-2xl shadow-sm">
            <div className="w-12 h-12 bg-gray-100 flex items-center justify-center rounded-lg mb-6 ">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M14.109 5.10414C14.4743 4.94178 14.8789 4.85156 15.3045 4.85156C16.932 4.85156 18.2514 6.17095 18.2514 7.79851C18.2514 9.42606 16.932 10.7455 15.3045 10.7455C14.8794 10.7455 14.4753 10.6555 14.1103 10.4935M15.797 13.2207C19.5989 13.4453 20.821 16.009 21.2134 17.6906C21.3993 18.4875 20.7424 19.1487 19.9241 19.1487H17.59M11.7512 7.79855C11.7512 9.4261 10.4318 10.7455 8.80427 10.7455C7.17671 10.7455 5.85732 9.4261 5.85732 7.79855C5.85732 6.171 7.17671 4.8516 8.80427 4.8516C10.4318 4.8516 11.7512 6.171 11.7512 7.79855ZM8.74941 13.205C12.9833 13.205 14.3026 15.9309 14.7132 17.6906C14.8991 18.4875 14.2422 19.1487 13.4239 19.1487H4.07489C3.25661 19.1487 2.59973 18.4875 2.78565 17.6906C3.19623 15.9309 4.51554 13.205 8.74941 13.205Z"
                  stroke="#1D2939"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div className="flex items-center justify-between">
              <div className="">
                <p className="text-sm leading-5 text-[#667085] mb-4">
                  Customer
                </p>
                <h3 className="text-3xl leading-8 font-bold mt-2">3,782</h3>
              </div>
              {/* badge */}
              <div className="mt-4">
                <svg
                  width="72"
                  height="24"
                  viewBox="0 0 72 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0 12C0 5.37258 5.37258 0 12 0H60C66.6274 0 72 5.37258 72 12C72 18.6274 66.6274 24 60 24H12C5.37258 24 0 18.6274 0 12Z"
                    fill="#ECFDF3"
                  />
                  <path
                    d="M13.998 7.99951L13.998 16.0002M11 10.9975L13.9999 7.99951L17 10.9975"
                    stroke="#039855"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M26.4389 17V8.782L24.7309 9.216V8.166L26.9569 7.2H27.8669V17H26.4389ZM31.0326 17V8.782L29.3246 9.216V8.166L31.5506 7.2H32.4606V17H31.0326ZM34.9964 17.07C34.7257 17.07 34.5017 16.986 34.3244 16.818C34.1564 16.6407 34.0724 16.4307 34.0724 16.188C34.0724 15.936 34.1564 15.726 34.3244 15.558C34.5017 15.3807 34.7257 15.292 34.9964 15.292C35.267 15.292 35.4864 15.3807 35.6544 15.558C35.8224 15.726 35.9064 15.936 35.9064 16.188C35.9064 16.4307 35.8224 16.6407 35.6544 16.818C35.4864 16.986 35.267 17.07 34.9964 17.07ZM40.7756 17.168C39.9076 17.168 39.161 16.958 38.5356 16.538C37.9103 16.1087 37.4296 15.516 37.0936 14.76C36.7576 13.9947 36.5896 13.108 36.5896 12.1C36.5896 11.092 36.7576 10.21 37.0936 9.454C37.4296 8.68867 37.9103 8.096 38.5356 7.676C39.161 7.24667 39.9076 7.032 40.7756 7.032C41.6436 7.032 42.3856 7.24667 43.0016 7.676C43.627 8.096 44.103 8.68867 44.4296 9.454C44.7656 10.21 44.9336 11.092 44.9336 12.1C44.9336 13.108 44.7656 13.9947 44.4296 14.76C44.103 15.516 43.627 16.1087 43.0016 16.538C42.3856 16.958 41.6436 17.168 40.7756 17.168ZM40.7756 15.922C41.2983 15.922 41.765 15.768 42.1756 15.46C42.5956 15.152 42.9223 14.7133 43.1556 14.144C43.389 13.5747 43.5056 12.8933 43.5056 12.1C43.5056 11.3067 43.389 10.6253 43.1556 10.056C42.9223 9.48667 42.5956 9.05267 42.1756 8.754C41.765 8.446 41.2983 8.292 40.7756 8.292C40.2436 8.292 39.7676 8.446 39.3476 8.754C38.9276 9.05267 38.601 9.48667 38.3676 10.056C38.1343 10.6253 38.0176 11.3067 38.0176 12.1C38.0176 12.8933 38.1343 13.5747 38.3676 14.144C38.601 14.7133 38.9276 15.152 39.3476 15.46C39.7676 15.768 40.2436 15.922 40.7756 15.922ZM47.7397 17V8.782L46.0317 9.216V8.166L48.2577 7.2H49.1677V17H47.7397ZM52.4034 17L58.0314 7.2H59.4174L53.7894 17H52.4034ZM58.8434 17.168C58.4047 17.168 58.0127 17.07 57.6674 16.874C57.3221 16.678 57.0467 16.4027 56.8414 16.048C56.6361 15.684 56.5334 15.2593 56.5334 14.774C56.5334 14.27 56.6361 13.8407 56.8414 13.486C57.0467 13.1313 57.3221 12.856 57.6674 12.66C58.0127 12.464 58.4001 12.366 58.8294 12.366C59.2774 12.366 59.6694 12.464 60.0054 12.66C60.3507 12.856 60.6214 13.1313 60.8174 13.486C61.0227 13.8407 61.1254 14.27 61.1254 14.774C61.1254 15.2593 61.0227 15.684 60.8174 16.048C60.6214 16.4027 60.3507 16.678 60.0054 16.874C59.6601 17.07 59.2727 17.168 58.8434 17.168ZM58.8154 16.132C59.0301 16.132 59.2214 16.0807 59.3894 15.978C59.5667 15.8753 59.7067 15.726 59.8094 15.53C59.9214 15.3247 59.9774 15.068 59.9774 14.76C59.9774 14.452 59.9261 14.2 59.8234 14.004C59.7207 13.7987 59.5807 13.6447 59.4034 13.542C59.2354 13.4393 59.0441 13.388 58.8294 13.388C58.6334 13.388 58.4467 13.4393 58.2694 13.542C58.0921 13.6447 57.9474 13.7987 57.8354 14.004C57.7327 14.2 57.6814 14.452 57.6814 14.76C57.6814 15.068 57.7327 15.3247 57.8354 15.53C57.9474 15.726 58.0874 15.8753 58.2554 15.978C58.4327 16.0807 58.6194 16.132 58.8154 16.132ZM53.0754 11.848C52.6461 11.848 52.2587 11.75 51.9134 11.554C51.5681 11.358 51.2881 11.0827 51.0734 10.728C50.8681 10.364 50.7654 9.93467 50.7654 9.44C50.7654 8.94533 50.8681 8.52067 51.0734 8.166C51.2881 7.81133 51.5681 7.536 51.9134 7.34C52.2681 7.144 52.6601 7.046 53.0894 7.046C53.5187 7.046 53.9061 7.144 54.2514 7.34C54.5967 7.536 54.8674 7.81133 55.0634 8.166C55.2687 8.52067 55.3714 8.94533 55.3714 9.44C55.3714 9.93467 55.2687 10.364 55.0634 10.728C54.8674 11.0827 54.5921 11.358 54.2374 11.554C53.8921 11.75 53.5047 11.848 53.0754 11.848ZM53.0754 10.812C53.2807 10.812 53.4674 10.7607 53.6354 10.658C53.8127 10.5553 53.9527 10.406 54.0554 10.21C54.1581 10.0047 54.2094 9.748 54.2094 9.44C54.2094 9.132 54.1581 8.87533 54.0554 8.67C53.9527 8.46467 53.8127 8.31067 53.6354 8.208C53.4674 8.10533 53.2854 8.054 53.0894 8.054C52.8841 8.054 52.6881 8.10533 52.5014 8.208C52.3241 8.31067 52.1794 8.46467 52.0674 8.67C51.9647 8.87533 51.9134 9.132 51.9134 9.44C51.9134 9.73867 51.9647 9.99067 52.0674 10.196C52.1794 10.4013 52.3241 10.5553 52.5014 10.658C52.6787 10.7607 52.8701 10.812 53.0754 10.812Z"
                    fill="#039855"
                  />
                </svg>
              </div>
            </div>
          </div>
          <div className="min-w-[300px] h-[180px] p-6 bg-white rounded-2xl shadow-sm">
            <div className="w-12 h-12 bg-gray-100 flex items-center justify-center rounded-lg mb-6 ">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10 19.072V9.02882M10 9.02882C9.77031 9.02876 9.54064 8.97598 9.32963 8.87047M10 9.02882C10.23 9.02889 10.46 8.97611 10.6712 8.87047M10.6712 8.87047C10.249 9.08161 9.75191 9.08161 9.32963 8.87047M10.6712 8.87047L18.2212 5.09562M9.32963 8.87047L1.7797 5.09562M18.2212 5.09562C18.078 4.87199 17.8754 4.68611 17.6287 4.56277L10.6712 1.08413C10.249 0.872998 9.75191 0.872997 9.32963 1.08413L2.37216 4.56277C2.12546 4.68611 1.92287 4.87199 1.7797 5.09562M18.2212 5.09562C18.3729 5.33264 18.4579 5.61207 18.4579 5.90441V14.0934C18.4579 14.6615 18.1369 15.1809 17.6287 15.435L10.6712 18.9137C10.249 19.1248 9.75191 19.1248 9.32963 18.9137L2.37216 15.435C1.86398 15.1809 1.54297 14.6615 1.54297 14.0934V5.90441C1.54297 5.61207 1.62796 5.33264 1.7797 5.09562"
                  stroke="#1D2939"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div className="flex items-center justify-between">
              <div className="">
                <p className="text-sm leading-5 text-[#667085] mb-4">Orders</p>
                <h3 className="text-3xl leading-8 font-bold mt-2">5,359</h3>
              </div>
              {/* badge */}
              <div className="mt-4">
                <svg
                  width="75"
                  height="24"
                  viewBox="0 0 75 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0 12C0 5.37258 5.37258 0 12 0H63C69.6274 0 75 5.37258 75 12C75 18.6274 69.6274 24 63 24H12C5.37259 24 0 18.6274 0 12Z"
                    fill="#FEF3F2"
                  />
                  <path
                    d="M13.998 16.0004L13.998 7.99976M11 13.0024L13.9999 16.0004L17 13.0024"
                    stroke="#D92D20"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M28.4464 17.168C27.8118 17.168 27.2704 17.0467 26.8224 16.804C26.3744 16.552 26.0198 16.2207 25.7584 15.81C25.4971 15.39 25.3384 14.9373 25.2824 14.452H26.5844C26.6778 14.9373 26.8878 15.3153 27.2144 15.586C27.5411 15.8473 27.9564 15.978 28.4604 15.978C28.9271 15.978 29.3378 15.838 29.6924 15.558C30.0471 15.278 30.3318 14.8533 30.5464 14.284C30.7611 13.7147 30.8824 12.996 30.9104 12.128C30.9198 12.1 30.9244 12.072 30.9244 12.044C30.9244 12.016 30.9244 11.988 30.9244 11.96C30.7751 12.24 30.5698 12.4967 30.3084 12.73C30.0471 12.9633 29.7391 13.15 29.3844 13.29C29.0391 13.4207 28.6518 13.486 28.2224 13.486C27.6718 13.486 27.1538 13.36 26.6684 13.108C26.1924 12.8467 25.8004 12.478 25.4924 12.002C25.1938 11.526 25.0444 10.9707 25.0444 10.336C25.0444 9.76667 25.1798 9.23 25.4504 8.726C25.7304 8.222 26.1224 7.816 26.6264 7.508C27.1398 7.19067 27.7418 7.032 28.4324 7.032C29.1511 7.032 29.7531 7.16733 30.2384 7.438C30.7331 7.69933 31.1251 8.05867 31.4144 8.516C31.7131 8.964 31.9278 9.468 32.0584 10.028C32.1984 10.5787 32.2684 11.148 32.2684 11.736C32.2684 12.8093 32.1191 13.7567 31.8204 14.578C31.5218 15.39 31.0878 16.0247 30.5184 16.482C29.9491 16.9393 29.2584 17.168 28.4464 17.168ZM28.5304 12.296C28.9318 12.296 29.2911 12.2073 29.6084 12.03C29.9258 11.8433 30.1778 11.596 30.3644 11.288C30.5511 10.98 30.6444 10.6393 30.6444 10.266C30.6444 9.874 30.5511 9.52867 30.3644 9.23C30.1778 8.922 29.9211 8.684 29.5944 8.516C29.2771 8.33867 28.9178 8.25 28.5164 8.25C28.1244 8.25 27.7698 8.33867 27.4524 8.516C27.1351 8.684 26.8831 8.922 26.6964 9.23C26.5191 9.52867 26.4304 9.87867 26.4304 10.28C26.4304 10.6813 26.5191 11.036 26.6964 11.344C26.8831 11.6427 27.1351 11.876 27.4524 12.044C27.7698 12.212 28.1291 12.296 28.5304 12.296ZM34.097 17.07C33.8263 17.07 33.6023 16.986 33.425 16.818C33.257 16.6407 33.173 16.4307 33.173 16.188C33.173 15.936 33.257 15.726 33.425 15.558C33.6023 15.3807 33.8263 15.292 34.097 15.292C34.3676 15.292 34.587 15.3807 34.755 15.558C34.923 15.726 35.007 15.936 35.007 16.188C35.007 16.4307 34.923 16.6407 34.755 16.818C34.587 16.986 34.3676 17.07 34.097 17.07ZM39.8762 17.168C39.0082 17.168 38.2616 16.958 37.6362 16.538C37.0109 16.1087 36.5302 15.516 36.1942 14.76C35.8582 13.9947 35.6902 13.108 35.6902 12.1C35.6902 11.092 35.8582 10.21 36.1942 9.454C36.5302 8.68867 37.0109 8.096 37.6362 7.676C38.2616 7.24667 39.0082 7.032 39.8762 7.032C40.7442 7.032 41.4862 7.24667 42.1022 7.676C42.7276 8.096 43.2036 8.68867 43.5302 9.454C43.8662 10.21 44.0342 11.092 44.0342 12.1C44.0342 13.108 43.8662 13.9947 43.5302 14.76C43.2036 15.516 42.7276 16.1087 42.1022 16.538C41.4862 16.958 40.7442 17.168 39.8762 17.168ZM39.8762 15.922C40.3989 15.922 40.8656 15.768 41.2762 15.46C41.6962 15.152 42.0229 14.7133 42.2562 14.144C42.4896 13.5747 42.6062 12.8933 42.6062 12.1C42.6062 11.3067 42.4896 10.6253 42.2562 10.056C42.0229 9.48667 41.6962 9.05267 41.2762 8.754C40.8656 8.446 40.3989 8.292 39.8762 8.292C39.3442 8.292 38.8682 8.446 38.4482 8.754C38.0282 9.05267 37.7016 9.48667 37.4682 10.056C37.2349 10.6253 37.1182 11.3067 37.1182 12.1C37.1182 12.8933 37.2349 13.5747 37.4682 14.144C37.7016 14.7133 38.0282 15.152 38.4482 15.46C38.8682 15.768 39.3442 15.922 39.8762 15.922ZM49.0942 17.168C48.4036 17.168 47.8109 17.0467 47.3162 16.804C46.8216 16.552 46.4296 16.216 46.1402 15.796C45.8509 15.3667 45.6736 14.886 45.6082 14.354H46.9802C47.0736 14.83 47.3069 15.222 47.6802 15.53C48.0536 15.8287 48.5249 15.978 49.0942 15.978C49.5236 15.978 49.8922 15.8753 50.2002 15.67C50.5082 15.4647 50.7462 15.1893 50.9142 14.844C51.0822 14.4987 51.1662 14.116 51.1662 13.696C51.1662 13.248 51.0776 12.8607 50.9002 12.534C50.7322 12.198 50.4942 11.9367 50.1862 11.75C49.8876 11.5633 49.5376 11.47 49.1362 11.47C48.6509 11.47 48.2309 11.582 47.8762 11.806C47.5309 12.0207 47.2789 12.296 47.1202 12.632H45.7622L46.5742 7.2H51.8522V8.418H47.6522L47.1342 11.162C47.3582 10.91 47.6569 10.7047 48.0302 10.546C48.4129 10.3873 48.8469 10.308 49.3322 10.308C49.8269 10.308 50.2702 10.3967 50.6622 10.574C51.0542 10.742 51.3856 10.98 51.6562 11.288C51.9362 11.596 52.1462 11.9553 52.2862 12.366C52.4356 12.7767 52.5102 13.2107 52.5102 13.668C52.5102 14.1627 52.4309 14.62 52.2722 15.04C52.1136 15.46 51.8849 15.8333 51.5862 16.16C51.2969 16.4773 50.9376 16.7247 50.5082 16.902C50.0882 17.0793 49.6169 17.168 49.0942 17.168ZM55.5099 17L61.1379 7.2H62.5239L56.8959 17H55.5099ZM61.9499 17.168C61.5112 17.168 61.1192 17.07 60.7739 16.874C60.4285 16.678 60.1532 16.4027 59.9479 16.048C59.7425 15.684 59.6399 15.2593 59.6399 14.774C59.6399 14.27 59.7425 13.8407 59.9479 13.486C60.1532 13.1313 60.4285 12.856 60.7739 12.66C61.1192 12.464 61.5065 12.366 61.9359 12.366C62.3839 12.366 62.7759 12.464 63.1119 12.66C63.4572 12.856 63.7279 13.1313 63.9239 13.486C64.1292 13.8407 64.2319 14.27 64.2319 14.774C64.2319 15.2593 64.1292 15.684 63.9239 16.048C63.7279 16.4027 63.4572 16.678 63.1119 16.874C62.7665 17.07 62.3792 17.168 61.9499 17.168ZM61.9219 16.132C62.1365 16.132 62.3279 16.0807 62.4959 15.978C62.6732 15.8753 62.8132 15.726 62.9159 15.53C63.0279 15.3247 63.0839 15.068 63.0839 14.76C63.0839 14.452 63.0325 14.2 62.9299 14.004C62.8272 13.7987 62.6872 13.6447 62.5099 13.542C62.3419 13.4393 62.1505 13.388 61.9359 13.388C61.7399 13.388 61.5532 13.4393 61.3759 13.542C61.1985 13.6447 61.0539 13.7987 60.9419 14.004C60.8392 14.2 60.7879 14.452 60.7879 14.76C60.7879 15.068 60.8392 15.3247 60.9419 15.53C61.0539 15.726 61.1939 15.8753 61.3619 15.978C61.5392 16.0807 61.7259 16.132 61.9219 16.132ZM56.1819 11.848C55.7525 11.848 55.3652 11.75 55.0199 11.554C54.6745 11.358 54.3945 11.0827 54.1799 10.728C53.9745 10.364 53.8719 9.93467 53.8719 9.44C53.8719 8.94533 53.9745 8.52067 54.1799 8.166C54.3945 7.81133 54.6745 7.536 55.0199 7.34C55.3745 7.144 55.7665 7.046 56.1959 7.046C56.6252 7.046 57.0125 7.144 57.3579 7.34C57.7032 7.536 57.9739 7.81133 58.1699 8.166C58.3752 8.52067 58.4779 8.94533 58.4779 9.44C58.4779 9.93467 58.3752 10.364 58.1699 10.728C57.9739 11.0827 57.6985 11.358 57.3439 11.554C56.9985 11.75 56.6112 11.848 56.1819 11.848ZM56.1819 10.812C56.3872 10.812 56.5739 10.7607 56.7419 10.658C56.9192 10.5553 57.0592 10.406 57.1619 10.21C57.2645 10.0047 57.3159 9.748 57.3159 9.44C57.3159 9.132 57.2645 8.87533 57.1619 8.67C57.0592 8.46467 56.9192 8.31067 56.7419 8.208C56.5739 8.10533 56.3919 8.054 56.1959 8.054C55.9905 8.054 55.7945 8.10533 55.6079 8.208C55.4305 8.31067 55.2859 8.46467 55.1739 8.67C55.0712 8.87533 55.0199 9.132 55.0199 9.44C55.0199 9.73867 55.0712 9.99067 55.1739 10.196C55.2859 10.4013 55.4305 10.5553 55.6079 10.658C55.7852 10.7607 55.9765 10.812 56.1819 10.812Z"
                    fill="#D92D20"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>
        {/* monthly sales */}
        <div className="">
          <MonthlySalesChart data={stats?.monthlySales} loading={loading} />
        </div>
      </div>

      {/* Monthly target section */}
      <div className="">
        <MonthlyTargetGauge summary={stats} loading={loading} error={error} />
      </div>

      {/* analytics section */}
      <div className="">
        <StatisticsCard stats={stats} loading={loading} error={error} />
      </div>
      <div className="flex flex-col lg:flex-row gap-6">
        {/*customer demographic  */}
        <div className="">
          <DemographicCard />
        </div>
        {/*  recent orders*/}
        <div className="">
          <OrderTable />
        </div>
      </div>
    </section>
  );
};

export default DashboardMain;
